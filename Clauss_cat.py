# author Dominik Capkovic 
# contact: domcapkovic@gmail.com; https://www.linkedin.com/in/dominik-čapkovič-b0ab8575/
# GitHub: https://github.com/kilimetr

import numpy as np 

function [dydt] = claus_cat(V,pars,yvec)
% CLAUS_R1
% 2H2S +    SO2 <=> 3/2S2  + 2H2O
% 2H2S +    SO2 <=> 0.5S6  + 2H2O
% 2H2S +    SO2 <=> 3/8S6  + 2H2O
%  H2S + 3/2O2  <=>    SO2 +  H2O
% H2S SO2 S2 S6 S8 H2O N2 O2

P     = pars(1); % [Pa]
Tin   = pars(2);

n(1) = yvec(1);
n(2) = yvec(2);
n(3) = yvec(3);
n(4) = yvec(4);
n(5) = yvec(5);
n(6) = yvec(6);
n(7) = yvec(7);
n(8) = yvec(8);
T    = yvec(9);

nTOT = n(1) + n(2) + n(3) + n(4) + n(5) + n(6) + n(7) + n(8);

y(1) = n(1) / nTOT;
y(2) = n(2) / nTOT;
y(3) = n(3) / nTOT;
y(4) = n(4) / nTOT;
y(5) = n(5) / nTOT;
y(6) = n(6) / nTOT;
y(7) = n(7) / nTOT;
y(8) = n(8) / nTOT;

p(1) = P*y(1) * T/Tin; % [Pa]
p(2) = P*y(2) * T/Tin;
p(3) = P*y(3) * T/Tin;
p(4) = P*y(4) * T/Tin;
p(5) = P*y(5) * T/Tin;
p(6) = P*y(6) * T/Tin;
p(7) = P*y(7) * T/Tin;
p(8) = P*y(8) * T/Tin;

k(1) = 1 * exp(1000*(1/500 - 1/T));
k(2) = 1 * exp(1000*(1/500 - 1/T));
k(3) = 1 * exp(1000*(1/500 - 1/T));
k(4) = 1 * exp(1000*(1/500 - 1/T));

K(1) = max(exp(0.00113561*T + 1.5273*log(T) - 9.75062e-7*T^2 + 2.35747e-10*T^3 - ...
       (1.0*(5274.48*T - 0.00000259201))/T^2 - 3.1067),1e-10);
K(2) = max(exp(0.00113561*T + 2.85037*log(T) - 9.75062e-7*T^2 + 2.35747e-10*T^3 + ...
       (12192.3*T + 0.00000259201)/T^2 - 31.8396),1e-10);
K(3) = max(exp(0.00113561*T + 3.10597*log(T) - 9.75062e-7*T^2 + 2.35747e-10*T^3 + ...
       (13868.8*T + 0.00000259201)/T^2 - 35.4364),1e-10);
K(4) = max(exp(1.17873e-10*T^3 - 4.47534*log(T) - 4.87531e-7*T^2 - 0.00000285663*T + ...
           (60904.6*T + 0.00000512629)/T^2 + 21.1096),1e-10);

cp(1) =  31.94  + (0.1436e-2)*T + (0.2432e-4)*T^2 + (-1.176e-8)*T^3; % [J/K/mol]
cp(2) =  36.162 +  0.845e-3  *T -    4.310e-5/T^2;
cp(3) =  35.0;
cp(4) = 127.0;
cp(5) = 175.0;
cp(6) =  30.12 +  11.300e-3 *T;
cp(7) =  27.82 +   0.00418  *T;
cp(8) =  47.7  +   0.007171 *T - 0.00008556/T^2;
 
drH(1) = +(4.62396e-35*(9.48365e38*T + 2.74613e35*T^2 + 2.04186e32*T^3 - 3.50637e29*T^4 + ...
           1.27164e26*T^5 - 9.32101e29))/T; % [J/mol]
drH(2) = -(4.62396e-35*(2.1922e39*T  - 5.12504e35*T^2 - 2.04186e32*T^3 + 3.50637e29*T^4 - ...
           1.27164e26*T^5 + 9.32101e29))/T;
drH(3) = -(4.62396e-35*(2.49364e39*T - 5.5846e35*T^2 - 2.04186e32*T^3 + 3.50637e29*T^4 - ...
           1.27164e26*T^5 + 9.32101e29))/T;
drH(4) = -(2.31198e-35*(2.19016e40*T + 1.60936e36*T^2 + 1.02726e30*T^3 + 3.50637e29*T^4 - ...
           1.27164e26*T^5 + 3.68688e30))/T;

r(1) = k(1)*(p(1)^(2)*p(2)       - p(3)^(3/2)*p(6)^(2)/K(1)); % S2
r(2) = k(2)*(p(1)^(2)*p(2)       - p(4)^(3/6)*p(6)^(2)/K(2)); % S6
r(3) = k(3)*(p(1)^(2)*p(2)       - p(5)^(3/8)*p(6)^(2)/K(3)); % S8
r(4) = k(4)*(p(1)    *p(8)^(3/2) - p(2)      *p(6)    /K(4)); % O2

dnH2SdV = -2.0*r(1) - 2.0*r(2) - 2.0*r(3) - 1.0*r(4);
dnSO2dV = -1.0*r(1) - 1.0*r(2) - 1.0*r(3) + 1.0*r(4);
dnS2dV  = +3/2*r(1);
dnS6dV  =            +0.5*r(2);
dnS8dV  =                       +3/8*r(3);
dnH2OdV = +2.0*r(1) + 2.0*r(2) + 2.0*r(3) + 1.0*r(4);
dnN2dV  = 0;
dnO2dV  =                                 - 3/2*r(4);

dTdV = - r(1)*drH(1) - r(2)*drH(2) - r(3)*drH(3) - r(4)*drH(4);
dTdV = dTdV / (cp(1)*n(1) + cp(2)*n(2) + cp(3)*n(3) + cp(4)*n(4) + ...
               cp(5)*n(5) + cp(6)*n(6) + cp(7)*n(7) + cp(8)*n(8));

dydt = [dnH2SdV dnSO2dV dnS2dV dnS6dV dnS8dV dnH2OdV dnN2dV dnO2dV dTdV];

dydt = dydt';

end


